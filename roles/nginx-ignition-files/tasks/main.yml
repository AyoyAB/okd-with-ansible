---

- name: Copy over nginx ignition configuration
  ansible.builtin.template:
    src: ignition.conf
    dest: /etc/nginx/sites-enabled/ignition.conf
    mode: '0644'
  notify: nginx restart

- name: Copy over generic ignition files
  ansible.builtin.copy:
    src: "{{ openshift_files_directory }}/{{ item }}.ign"
    dest: "{{ nginx_ignition_files_dir }}/{{ item }}.ign"
    mode: '0644'
  with_items:
    - "bootstrap"
    - "master"
    - "worker"
  notify: nginx restart

- name: Copy over bootstrap ignition files
  ansible.builtin.copy:
    src: "{{ openshift_files_directory }}/{{ item }}.ign"
    dest: "{{ nginx_ignition_files_dir }}/{{ item }}.ign"
    mode: '0644'
  loop: "{{ groups['bootstrap'] }}"
  notify: nginx restart

- name: Copy over master ignition files
  ansible.builtin.copy:
    src: "{{ openshift_files_directory }}/{{ item }}.ign"
    dest: "{{ nginx_ignition_files_dir }}/{{ item }}.ign"
    mode: '0644'
  loop: "{{ groups['masters'] }}"
  notify: nginx restart

- name: Copy over worker ignition files
  ansible.builtin.copy:
    src: "{{ openshift_files_directory }}/{{ item }}.ign"
    dest: "{{ nginx_ignition_files_dir }}/{{ item }}.ign"
    mode: '0644'
  loop: "{{ groups['nodes'] }}"
  notify: nginx restart

- name: Copy install.sh
  ansible.builtin.copy:
    src: "{{ openshift_files_directory }}/install.sh"
    dest: "{{ nginx_ignition_files_dir }}/install.sh"
    mode: '0644'
  notify: nginx restart

- name: Configure UFW port openings
  ansible.builtin.include_tasks: "ufw.yml"
  when: configure_ufw
